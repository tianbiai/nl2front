# 前端 Agent 工作流程

## 🛑 MANDATORY 强制规则（最高优先级）

**⚠️ 违反以下任何规则将导致开发失败，必须无条件遵守！**

### 规则 1：文档驱动开发（绝对强制）

```yaml
强制要求:
  - 编写代码前必须先生成对应的 spec.md
  - 页面级 /specs/{页面名}.md 不存在时，禁止编写任何页面代码
  - {页面名}.vue代码必须与{页面名}.md 完全一致
阻断机制:
  - 发现项目 spec.md 不存在 → 立即停止开发 → 先生成项目 spec.md
  - 发现/specs/{页面名}.md 不存在 → 立即停止代码编写 → 先生成 {页面名}.md
违规后果:
  - 直接拒绝继续开发
  - 要求先生成完整的规格说明文档
```

### 规则 2：页面开发强制检查清单

**每次开发页面时，必须按顺序执行以下检查：**

```yaml
步骤 1 - 强制阻断检查:
  执行时机: 收到页面开发任务时
  检查项: 页面级 {页面名}.md 是否存在？
  - 是 → 继续
  - 否 → 🛑 立即停止，生成{页面名}.md

步骤 2 - 强制阅读检查:
  执行时机: 开始编写代码前
  检查项: 是否完整阅读了{页面名}.md？
  - 是 → 继续
  - 否 → 🛑 立即停止，完整阅读后再开始

步骤 3 - 强制一致性检查:
  执行时机: 代码编写过程中
  检查项: 代码是否严格按照{页面名}.md实现？
  - 是 → 继续
  - 否 → 🛑 立即停止，调整代码或更新{页面名}.md

步骤 4 - 页面创建后强制验证:
  执行时机: 页面代码创建完成后
  检查项: 项目 specs 目录下是否存在对应的 {页面名}.md？
  路径验证: projects/项目名/specs/{页面名}.md
  对应关系: 与 projects/项目名/src/{pages|views}/{页面名}/{页面名}.vue 一一对应
  判断:
    - 存在 → 验证通过
    - 不存在 → 🛑 立即生成{页面名}.md，禁止继续其他开发

### ⚠️ 页面强制要求（适用于所有页面）

**帮助说明气泡（强制）**：
- **位置**：页面可视化区域的右上角（固定定位）
- **图标**：使用醒目的问号图标（`QuestionFilled` 或类似图标）
- **交互**：点击气泡显示帮助内容
- **显示方式**：气泡弹出、Popover 或 Drawer
- **内容滚动**：气泡内容显示区域应包含滚动条，若内容过多，可使用滚动条滚动查看
- **帮助内容**：
  - 页面功能说明
  - 业务流程说明
  - 其他注意事项
```

### 规则 3：技术栈强制约束

- **移动端（uniapp H5）**: Vue 3.4.21, vant4, Vite 5.2.8, Pinia 2.1.7 ，vue-router 4.0.3，axios 1.6.8
- **Web端（Vue 3）**: Vue 3.4.21, Vite 5.2.0, Element Plus 2.6.1, Vue Router 4.3.0, Pinia 2.1.7，axios 1.6.8

---

## 📚 技能文档参考

编写规格说明时遵循以下技能文档：

- **核心技能**：[vue-best-practices/SKILL.md](skills/vue-best-practices/SKILL.md) ⭐⭐⭐
- **开发指南**：[vue-development-guides/SKILL.md](skills/vue-development-guides/SKILL.md) ⭐⭐⭐
- **设计规范**：[frontend-design/SKILL.md](skills/frontend-design/SKILL.md) ⭐⭐
- **完整清单**：[skills-checklist.md](rules/skills-checklist.md)

---

## 🔄 完整工作流程

```
需求分析 → 项目 spec.md → 搭建项目代码整体框架 → 详细功能开发 → 验证 → 交付
            ↓                    ↑
            └─ 页面 spec.md ──────┘
```

### 阶段 0️⃣：需求分析与澄清

**核心原则**：主动沟通，充分理解，避免误解。

使用 `AskUserQuestion` 工具确认基础要素和设计要素。若一次交互无法确认完，可进行多轮对话确认：

#### 基础要素

| 要素     | 说明              | 示例                             |
| -------- | ----------------- | -------------------------------- |
| 页面名称 | 页面唯一标识      | 用户登录页                       |
| 核心目标 | 解决什么问题      | 用户通过手机号和验证码登录       |
| 目标平台 | 移动端/Web端/双端 | 移动端使用 uniapp H5 模式        |
| 功能清单 | 包含哪些功能模块  | 登录表单、第三方登录             |
| 数据来源 | 数据从哪获取      | 用户输入、后端 API、本地存储     |
| 交互流程 | 用户操作路径      | 输入手机号 → 获取验证码 → 登录 |

#### 设计要素（重要）

| 设计要素 | 说明                   | 示例                       |
| -------- | ---------------------- | -------------------------- |
| 设计理念 | 整体设计思想和风格定位 | 极简主义、科技感           |
| 视觉风格 | 页面的整体视觉风格     | 现代简约、扁平化           |
| 主色调   | 品牌主色               | 科技蓝 #007AFF             |
| 辅助色   | 辅助色彩配色方案       | 成功绿、警告黄、错误红     |
| 布局方式 | 页面整体布局结构       | 左右分栏、上下布局、卡片式 |
| 参考案例 | 设计参考网站或应用     | Awwwards、SiteInspire      |

---

### 阶段 1️⃣：生成项目级 spec.md

**前置条件**：需求分析与澄清完成

**操作步骤**：

1. 使用模板 `rules/project-spec-template.md`
2. 生成文件：`projects/项目名/spec.md（项目名应使用英文名称）`
3. 确认技术栈选型（见上方"规则 3"）

**需求变更**：任何新增/调整需求必须先更新项目级 spec.md

---

### 阶段 2️⃣：搭建项目代码整体框架

**前置条件**：项目级 spec.md 已完成

**目标**：根据项目 spec.md 搭建项目基础代码结构

**操作步骤**：

1. **初始化项目**

   - 根据技术栈选型创建项目
   - 安装必要依赖
2. **创建目录结构**

   - 移动端（uniapp）：`src/pages/`、`src/components/`、`src/utils/`、`src/api/`、`src/store/`
   - Web端（Vue 3）：`src/views/`、`src/components/`、`src/utils/`、`src/api/`、`src/store/`
   - **注意**：`specs/` 目录位于项目根目录（与 `src/` 同级），用于存放页面级规格说明
3. **配置基础文件**

   - 路由配置
   - 状态管理配置
   - 通用工具函数
   - API 接口封装
   - 全局样式配置
4. **创建页面框架**

   - 根据 spec.md 中的页面清单，创建各页面目录
   - 创建 specs 目录用于存放页面级规格说明
   - 为每个页面创建基础页面文件

**验证通过后**：进入阶段三进行详细功能开发

---

### 阶段 3️⃣：详细功能开发

**🛑 前置条件检查**：

- [ ] 项目级 spec.md 已完成
- [ ] 项目代码框架已搭建完成

**开发策略**：

若项目复杂，可采用以下策略进行开发：

1. **MVP 开发**：先实现核心功能，快速验证可行性
2. **分阶段开发**：按功能模块分批实现，逐步完善

**页面开发强制流程**：

```yaml
步骤 1: 检查页面级 spec.md 是否存在
  执行: Read 读取 projects/项目名/specs/{页面名}.md
  判断:
    - 存在 → 继续
    - 不存在 → 🛑 立即停止，使用 rules/spec-template.md 生成

步骤 2: 完整阅读页面级 spec.md
  执行: 阅读所有章节内容
  确认: 理解所有功能需求和设计要求

步骤 3: 编写代码
  执行: 严格按照 spec.md 编写代码
  约束: 不得超出 spec.md 范围

步骤 4: 验证功能
  执行: uniapp 使用浏览器 H5 模式验证
  确认: 所有功能正常运行

步骤 5: 页面创建后强制验证
  执行时机: 页面代码创建完成后
  执行: 验证 specs 目录下是否存在对应的 {页面名}.md
  检查项: projects/项目名/specs/{页面名}.md 是否存在？
  对应关系: 应与 projects/项目名/src/{pages|views}/{页面名}/{页面名}.vue 一一对应
  判断:
    - 存在 → 验证通过，继续开发
    - 不存在 → 🛑 立即停止，使用 rules/spec-template.md 生成页面级 spec.md
  阻断机制:
    - 未完成 spec.md 生成前，禁止继续开发其他功能
    - 未完成 spec.md 生成前，禁止提交代码
```

**其他规范**：

- **API 接口**：当前阶段均使用 Mock 数据，不进行实际 HTTP 请求
- **需求变更**：发现需要新增功能时，先更新项目 spec.md，再更新页面级 spec.md

---

### 阶段 4️⃣：项目验证

**验证内容**：

1. ✅ 项目可编译且正常启动
2. ✅ 所有功能正常运行
3. ✅ 无"功能开发中"占位代码
4. ✅ 代码与 spec.md 一致

**验证方式**：uniapp 项目使用 H5 模式（浏览器）

---

## 📁 项目结构

```
projects/                    # 各项目目录
 ├── 项目名/                  # 移动端/Web端项目
 │   ├── spec.md              # 项目级 spec.md
 │   ├── specs/               # 页面级规格说明目录（统一存放）
 │   │   ├── 页面名.md        # {页面名}.md，与 {页面名}.vue 一一对应
 │   │   └── ...
 │   └── src/
 │       ├── pages/           # 页面目录（移动端）
 │       │   └── 页面名/
 │       │       └── 页面名.vue
 │       └── views/           # 页面目录（Web端）
 │           └── 页面名/
 │               └── 页面名.vue
```

---

## 🔒 关键提醒

1. **文档优先**：任何代码编写前必须先有对应的 spec.md
2. **强制阻断**：页面级 {页面名}.md 不存在时，必须立即停止代码编写
3. **完整阅读**：编写代码前必须完整阅读页面级 {页面名}.md
4. **严格一致**：代码必须与 {页面名}.md 完全一致
5. **H5 优先**：uniapp 项目必须使用 H5 模式开发和验证
6. **创建验证**：页面代码创建后必须验证是否存在对应的 {页面名}.md，不存在则立即生成
